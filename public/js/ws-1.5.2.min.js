"use strict";$(document).ready(function(){console.log("Establishing connection..."),socket.Connect()});var socket={host:"wss://ws.luckygames.io/",id:!1,socketID:!1,Connect:function(){if(!1!==socket.id)return!1;socket.id=new WebSocket(socket.host),socket.id.onopen=function(e){socket.id.send('{"action": "connect", "params":{"session":"'+getCookie("SESSION")+'","room":"'+getCookie("uROOM")+'"}}')},socket.id.onmessage=function(e){socket.Message(e)},socket.id.onclose=function(e){socket.Reconnect()},socket.onerror=function(e){socket.Reconnect()}},Message:function(e){try{e=JSON.parse(e.data),actions[e.action](e.params)}catch(e){}},Reconnect:function(){socket.id=!1,console.log("Reconnecting..."),setTimeout(socket.Connect(),1e3)}},actions={Connect:function(e){socket.socketID=e.socketID,Chat.room=e.room,setCookie("uROOM",e.room,365),$("#rooms .room.active").removeClass("active"),$("#rooms .room[data-id="+e.room+"]").addClass("active"),$("#roomCode").html(e.room),jQuery.ajax({url:"/ajx/",type:"POST",dataType:"html",async:!0,data:{action:"wsLoad",room:e.room,hash:user.hash},success:function(e){$("#chatBody").empty(),$("#chatLog").removeClass("busy"),$("#pmsUnread").text("0").removeClass("show"),$("#pmsList .sidebarListItem .unread").each(function(){$(this).remove()}),$("#friendsUnread").text("0").removeClass("show"),e=JSON.parse(e),actions[e.action](e.params)}}),console.log("Sucessfully connected to websocket")},Actions:function(e){if("object"==typeof e)for(var s=0;s<e.length;s++)"function"==typeof actions[e[s].action]&&actions[e[s].action](e[s].params)},Reconnect:function(){socket.read=!1,socket.Connect()},ChatPrint:function(e){Chat.print(e)},ChatNotify:function(e){Chat.notify(e)},ChangeRoom:function(e){if(Chat.busy=!1,!e.room)return!1;Chat.room=e.room,setCookie("uROOM",e.room,365),$("#rooms .room.active").removeClass("active"),$("#rooms .room[data-id="+e.room+"]").addClass("active"),$("#roomCode").html(e.room),jQuery.ajax({url:"/ajx/",type:"POST",dataType:"html",async:!0,data:{action:"changeRoom",room:e.room,hash:user.hash},success:function(e){$("#chatLog").removeClass("busy"),e=JSON.parse(e),actions[e.action](e.params)}})},BetPrint:function(e){if("on"==getCookie("uECO"))return!1;if(user.game!=e.game||"main"!=user.module||$("#mainhide").length>0)return!1;if($("#bet"+e.betID).length>0)return!1;if(!0!==e.high||$("#highBets").hasClass("active")||user.id==e.userID||$("#highBets .newBets").html(1*$("#highBets .newBets").html()+1).addClass("show"),!0!==e.rare||$("#rareBets").hasClass("active")||user.id==e.userID||$("#rareBets .newBets").html(1*$("#rareBets .newBets").html()+1).addClass("show"),$("#myBets").hasClass("active"))return!1;if($("#allBets").hasClass("active")){if(user.id==e.userID)return!1}else if($("#highBets").hasClass("active")){if(user.id==e.userID)return!1;if(1!=e.high)return!1}else if($("#rareBets").hasClass("active")){if(user.id==e.userID)return!1;if(1!=e.rare)return!1}var s=$("#listContainer .table .tbody .tr:first-child");if(s.hasClass("full"))s.remove(),$("#listContainer .table .tbody").append(e.html);else{s.before(e.html);var t=$("#listContainer .table .tbody .tr").length;if(t>40)for(var i=0;i<t-40;i++)$("#listContainer .table .tbody .tr:last-child").remove()}bindLinks()},Balance:function(e){e.coin==$("#coinID").val()&&$("#balance").val()!=e.amount&&!1===Game.playFlag&&$("#balance").val(e.amount)},Trxcount:function(e){e.coin==$("#coinID").val()&&$("#ucount").html(e.ucount)},Growl:function(e){growl.notice(e),bindLinks()},Notification:function(e){"error"==e.type&&$.notification.error({message:e.msg}),"notice"==e.type&&$.notification.notice({message:e.msg}),void 0!==e.popupshow&&$("#"+e.popupshow).popupShow()},SetAddress:function(e){e.address&&e.coin&&$("#coin").val()==e.coin&&$("#address").val()!=e.address&&$("input.address").each(function(){$(this).val(e.address)})},UsersOnline:function(e){$(".usersOnline").text(e.count)},Usergroup:function(){AjaxContent({url:"/",container:"#faucetUnload, #gameContainer .userInfo",content:"#faucetUnload, #gameContainer .userInfo",active:!1,activeRemove:!1,busy:!1,callback:function(){$("#sidebar .sidebarNav").css("margin-top",$("#sidebar .sidebarNav").height()/2*-1)}})},SiteStats:function(e){void 0!==e.totalBets&&$("#totalBets").html()!=e.totalBets&&e.totalBets>0&&$("#totalBets").animateAmount(e.totalBets,0,"",","),void 0!==e.totalWon&&$("#totalWon").html()!=e.totalWon&&e.totalWon>0&&$("#totalWon").animateAmount(e.totalWon,2,".",","),void 0!==e.jackpot&&$("#jackpotValue1").html()!=e.jackpot&&e.jackpot>0&&e.game==user.game&&($("#jackpotValue1").animateAmount(e.jackpot,8,".",","),$("#jackpotValue2").length>0&&$("#jackpotValue2").animateAmount(e.jackpot,8,".",","))},NewRound:function(e){if(user.game!=e.game)return!1;Game.newRound(e)},OpenCell:function(e){if(user.game!=e.game)return!1;Game.openCell(e)},Friends:function(e){if("request"==e.status){if($("#friendsRequests .sidebarListItem[data-id="+e.id+"]").length>0||$("#friendsList .sidebarListItem[data-id="+e.id+"]").length>0||$("#friendsList .sidebarListItem[data-user_id="+e.user_id+"]").length>0)return!1;s='<div class="sidebarListItem" data-id="'+e.id+'" data-user_id="'+e.user_id+'" data-username="'+e.username+'" data-online="'+e.online+'"><div class="avatar"><img src="/avatars/'+e.avatar+'" alt="'+e.username+'"><div class="usergroup '+e.group+'">'+e.group+'</div><div class="userlevel level'+e.level+'">'+e.level+'</div></div><div class="username binduser" data-username="'+e.username+'">'+e.username+'</div><div class="sidebarListItemOptions"><div class="btn green" onclick="Chat.friends(\''+e.username+"', 'accept'); return false;\">"+("ru"==user.lang?"Принять":"Accept")+'</div><div class="btn red" onclick="Chat.friends(\''+e.username+"', 'decline'); return false;\">"+("ru"==user.lang?"Отклонить":"Decline")+"</div></div></div>";$("#friendsRequests").removeClass("hide"),$("#friendsRequests .list").find(".sidebarListItem").length||$("#friendsRequests .list").html(""),$("#friendsRequests .list").prepend(s),$("#friendsRequests .counter").html($("#friendsRequests .sidebarListItem").length),$("#friendsUnread").html(1*$("#friendsUnread").html()+1),$("#friendsUnread").hasClass("show")||$("#friendsUnread").addClass("show"),1!=e.history&&Friends.newrequest.play(),"true"==e.online&&$("#friendsList .sidebarListItem[data-id="+e.id+"] .sidebarListItemOptions").prepend('<div class="online">online</div>')}else if("waiting"==e.status){if($("#friendsRequests .sidebarListItem[data-id="+e.id+"]").length>0||$("#friendsList .sidebarListItem[data-id="+e.id+"]").length>0||$("#friendsList .sidebarListItem[data-user_id="+e.user_id+"]").length>0)return!1;s='<div class="sidebarListItem" data-id="'+e.id+'" data-user_id="'+e.user_id+'" data-username="'+e.username+'" data-online="'+e.online+'"><div class="avatar"><img src="/avatars/'+e.avatar+'" alt="'+e.username+'"><div class="usergroup '+e.group+'">'+e.group+'</div><div class="userlevel level'+e.level+'">'+e.level+'</div></div><div class="username binduser" data-username="'+e.username+'">'+e.username+'</div><div class="sidebarListItemOptions"><div class="btn red" onclick="Chat.friends(\''+e.username+"', 'cancel'); return false;\">"+("ru"==user.lang?"Отменить":"Cancel")+"</div></div></div>";$("#friendsRequests").removeClass("hide"),$("#friendsRequests .list").find(".sidebarListItem").length||$("#friendsRequests .list").html(""),$("#friendsRequests .list").prepend(s),$("#friendsRequests .counter").html($("#friendsRequests .sidebarListItem").length)}else if("friends"==e.status){if(($("#friendsRequests .sidebarListItem[data-user_id="+e.user_id+"]").length>0||$("#friendsRequests .sidebarListItem[data-id="+e.id+"]").length>0)&&("true"==$("#friendsRequests .sidebarListItem[data-user_id="+e.user_id+"]").attr("data-online")&&(e.online="true"),$("#friendsRequests .sidebarListItem[data-user_id="+e.user_id+"]").remove(),$("#friendsRequests .sidebarListItem[data-id="+e.id+"]").remove(),$("#friendsUnread").html(1*$("#friendsUnread").html()-1),1*$("#friendsUnread").html()<0&&$("#friendsUnread").html("0"),1*$("#friendsUnread").html()==0&&$("#friendsUnread").removeClass("show"),$("#friendsRequests .counter").html($("#friendsRequests .sidebarListItem").length),$("#friendsRequests .sidebarListItem").length||$("#friendsRequests").addClass("hide")),$("#friendsList .sidebarListItem[data-id="+e.id+"]").length>0||$("#friendsList .sidebarListItem[data-user_id="+e.user_id+"]").length>0)return!1;s='<div class="sidebarListItem" data-id="'+e.id+'" data-user_id="'+e.user_id+'" data-username="'+e.username+'" data-online="'+e.online+'"><div class="avatar"><img src="/avatars/'+e.avatar+'" alt="'+e.username+'"><div class="usergroup '+e.group+'">'+e.group+'</div><div class="userlevel level'+e.level+'">'+e.level+'</div></div><div class="username binduser" data-username="'+e.username+'">'+e.username+'</div><div class="sidebarListItemOptions"><div class="btn red" onclick="Chat.friends(\''+e.username+"', 'decline'); return false;\">"+("ru"==user.lang?"Удалить":"Remove")+"</div></div></div>";$("#friendsList .list").find(".sidebarListItem").length||$("#friendsList .list").html(""),"true"!=e.online&&$("#friendsList .sidebarListItem[data-online=true]:last").length>0?$("#friendsList .sidebarListItem[data-online=true]:last").after(s):$("#friendsList .list").prepend(s),$("#friendsList .counter").html($("#friendsList .sidebarListItem").length),"true"==e.online&&$("#friendsList .sidebarListItem[data-id="+e.id+"] .sidebarListItemOptions").prepend('<div class="online">online</div>')}else if("ignore"==e.status){if($("#ignoreList .sidebarListItem[data-id="+e.id+"]").length>0)return!1;var s='<div class="sidebarListItem" data-id="'+e.id+'" data-user_id="'+e.user_id+'" data-username="'+e.username+'"><div class="avatar"><img src="/avatars/'+e.avatar+'" alt="'+e.username+'"><div class="usergroup '+e.group+'">'+e.group+'</div><div class="userlevel level'+e.level+'">'+e.level+'</div></div><div class="username binduser" data-username="'+e.username+'">'+e.username+'</div><div class="sidebarListItemOptions"><div class="btn red" onclick="Chat.friends(\''+e.username+"', 'unignore'); return false;\">"+("ru"==user.lang?"Удалить":"Remove")+"</div></div></div>";$("#ignoreList .list").find(".sidebarListItem").length||$("#ignoreList .list").html(""),$("#ignoreList .list").prepend(s),$("#ignoreList .counter").html($("#ignoreList .sidebarListItem").length)}else"unignore"==e.status?$("#ignoreList .sidebarListItem[data-user_id="+e.user_id+"]").length>0&&($("#ignoreList .sidebarListItem[data-user_id="+e.user_id+"]").remove(),$("#ignoreList .counter").html($("#ignoreList .sidebarListItem").length),$("#ignoreList .sidebarListItem").length||$("#ignoreList .list").html("ru"==user.lang?"Здесь никого нет":"Nobody's here")):"decline"==e.status&&($("#friendsRequests .sidebarListItem[data-user_id="+e.user_id+"]").length>0&&($("#friendsRequests .sidebarListItem[data-user_id="+e.user_id+"]").remove(),$("#friendsUnread").html(1*$("#friendsUnread").html()-1),1*$("#friendsUnread").html()<0&&$("#friendsUnread").html("0"),1*$("#friendsUnread").html()==0&&$("#friendsUnread").removeClass("show"),$("#friendsRequests .counter").html($("#friendsRequests .sidebarListItem").length),$("#friendsRequests .sidebarListItem").length||($("#friendsRequests .list").html("ru"==user.lang?"Здесь никого нет":"Nobody's here"),$("#friendsRequests").addClass("hide"))),$("#friendsList .sidebarListItem[data-user_id="+e.user_id+"]").length>0&&($("#friendsList .sidebarListItem[data-user_id="+e.user_id+"]").remove(),$("#friendsList .counter").html($("#friendsList .sidebarListItem").length),$("#friendsList .sidebarListItem").length||$("#friendsList .list").html("ru"==user.lang?"Здесь никого нет":"Nobody's here")));$(".tooltipstered[data-username="+e.username+"]").each(function(){$(this).tooltipster("destroy").addClass("binduser")}),Friends.resize(),bindLinks()},Pvp:function(e){if("request"==e.status){if($("#friendsRequests .sidebarListItem[data-id="+e.id+"]").length>0||$("#friendsList .sidebarListItem[data-id="+e.id+"]").length>0||$("#friendsList .sidebarListItem[data-user_id="+e.user_id+"]").length>0)return!1;s='<div class="sidebarListItem" data-id="'+e.id+'" data-user_id="'+e.user_id+'" data-username="'+e.username+'" data-online="'+e.online+'"><div class="avatar"><img src="/avatars/'+e.avatar+'" alt="'+e.username+'"><div class="usergroup '+e.group+'">'+e.group+'</div><div class="userlevel level'+e.level+'">'+e.level+'</div></div><div class="username binduser" data-username="'+e.username+'">'+e.username+'</div><div class="sidebarListItemOptions"><div class="btn green" onclick="Chat.friends(\''+e.username+"', 'accept'); return false;\">"+("ru"==user.lang?"Принять":"Accept")+'</div><div class="btn red" onclick="Chat.friends(\''+e.username+"', 'decline'); return false;\">"+("ru"==user.lang?"Отклонить":"Decline")+"</div></div></div>";$("#friendsRequests").removeClass("hide"),$("#friendsRequests .list").find(".sidebarListItem").length||$("#friendsRequests .list").html(""),$("#friendsRequests .list").prepend(s),$("#friendsRequests .counter").html($("#friendsRequests .sidebarListItem").length),$("#friendsUnread").html(1*$("#friendsUnread").html()+1),$("#friendsUnread").hasClass("show")||$("#friendsUnread").addClass("show"),1!=e.history&&Friends.newrequest.play(),"true"==e.online&&$("#friendsList .sidebarListItem[data-id="+e.id+"] .sidebarListItemOptions").prepend('<div class="online">online</div>')}else if("waiting"==e.status){if($("#friendsRequests .sidebarListItem[data-id="+e.id+"]").length>0||$("#friendsList .sidebarListItem[data-id="+e.id+"]").length>0||$("#friendsList .sidebarListItem[data-user_id="+e.user_id+"]").length>0)return!1;s='<div class="sidebarListItem" data-id="'+e.id+'" data-user_id="'+e.user_id+'" data-username="'+e.username+'" data-online="'+e.online+'"><div class="avatar"><img src="/avatars/'+e.avatar+'" alt="'+e.username+'"><div class="usergroup '+e.group+'">'+e.group+'</div><div class="userlevel level'+e.level+'">'+e.level+'</div></div><div class="username binduser" data-username="'+e.username+'">'+e.username+'</div><div class="sidebarListItemOptions"><div class="btn red" onclick="Chat.friends(\''+e.username+"', 'cancel'); return false;\">"+("ru"==user.lang?"Отменить":"Cancel")+"</div></div></div>";$("#friendsRequests").removeClass("hide"),$("#friendsRequests .list").find(".sidebarListItem").length||$("#friendsRequests .list").html(""),$("#friendsRequests .list").prepend(s),$("#friendsRequests .counter").html($("#friendsRequests .sidebarListItem").length)}else if("friends"==e.status){if(($("#friendsRequests .sidebarListItem[data-user_id="+e.user_id+"]").length>0||$("#friendsRequests .sidebarListItem[data-id="+e.id+"]").length>0)&&("true"==$("#friendsRequests .sidebarListItem[data-user_id="+e.user_id+"]").attr("data-online")&&(e.online="true"),$("#friendsRequests .sidebarListItem[data-user_id="+e.user_id+"]").remove(),$("#friendsRequests .sidebarListItem[data-id="+e.id+"]").remove(),$("#friendsUnread").html(1*$("#friendsUnread").html()-1),1*$("#friendsUnread").html()<0&&$("#friendsUnread").html("0"),1*$("#friendsUnread").html()==0&&$("#friendsUnread").removeClass("show"),$("#friendsRequests .counter").html($("#friendsRequests .sidebarListItem").length),$("#friendsRequests .sidebarListItem").length||$("#friendsRequests").addClass("hide")),$("#friendsList .sidebarListItem[data-id="+e.id+"]").length>0||$("#friendsList .sidebarListItem[data-user_id="+e.user_id+"]").length>0)return!1;s='<div class="sidebarListItem" data-id="'+e.id+'" data-user_id="'+e.user_id+'" data-username="'+e.username+'" data-online="'+e.online+'"><div class="avatar"><img src="/avatars/'+e.avatar+'" alt="'+e.username+'"><div class="usergroup '+e.group+'">'+e.group+'</div><div class="userlevel level'+e.level+'">'+e.level+'</div></div><div class="username binduser" data-username="'+e.username+'">'+e.username+'</div><div class="sidebarListItemOptions"><div class="btn red" onclick="Chat.friends(\''+e.username+"', 'decline'); return false;\">"+("ru"==user.lang?"Удалить":"Remove")+"</div></div></div>";$("#friendsList .list").find(".sidebarListItem").length||$("#friendsList .list").html(""),"false"==e.online&&$("#friendsList .sidebarListItem[data-online=true]:last").length>0?$("#friendsList .sidebarListItem[data-online=true]:last").after(s):$("#friendsList .list").prepend(s),$("#friendsList .counter").html($("#friendsList .sidebarListItem").length),"true"==e.online&&$("#friendsList .sidebarListItem[data-id="+e.id+"] .sidebarListItemOptions").prepend('<div class="online">online</div>')}else if("ignore"==e.status){if($("#ignoreList .sidebarListItem[data-id="+e.id+"]").length>0)return!1;var s='<div class="sidebarListItem" data-id="'+e.id+'" data-user_id="'+e.user_id+'" data-username="'+e.username+'"><div class="avatar"><img src="/avatars/'+e.avatar+'" alt="'+e.username+'"><div class="usergroup '+e.group+'">'+e.group+'</div><div class="userlevel level'+e.level+'">'+e.level+'</div></div><div class="username binduser" data-username="'+e.username+'">'+e.username+'</div><div class="sidebarListItemOptions"><div class="btn red" onclick="Chat.friends(\''+e.username+"', 'unignore'); return false;\">"+("ru"==user.lang?"Удалить":"Remove")+"</div></div></div>";$("#ignoreList .list").find(".sidebarListItem").length||$("#ignoreList .list").html(""),$("#ignoreList .list").prepend(s),$("#ignoreList .counter").html($("#ignoreList .sidebarListItem").length)}else"unignore"==e.status?$("#ignoreList .sidebarListItem[data-user_id="+e.user_id+"]").length>0&&($("#ignoreList .sidebarListItem[data-user_id="+e.user_id+"]").remove(),$("#ignoreList .counter").html($("#ignoreList .sidebarListItem").length),$("#ignoreList .sidebarListItem").length||$("#ignoreList .list").html("ru"==user.lang?"Здесь никого нет":"Nobody's here")):"decline"==e.status&&($("#friendsRequests .sidebarListItem[data-user_id="+e.user_id+"]").length>0&&($("#friendsRequests .sidebarListItem[data-user_id="+e.user_id+"]").remove(),$("#friendsUnread").html(1*$("#friendsUnread").html()-1),1*$("#friendsUnread").html()<0&&$("#friendsUnread").html("0"),1*$("#friendsUnread").html()==0&&$("#friendsUnread").removeClass("show"),$("#friendsRequests .counter").html($("#friendsRequests .sidebarListItem").length),$("#friendsRequests .sidebarListItem").length||($("#friendsRequests .list").html("ru"==user.lang?"Здесь никого нет":"Nobody's here"),$("#friendsRequests").addClass("hide"))),$("#friendsList .sidebarListItem[data-user_id="+e.user_id+"]").length>0&&($("#friendsList .sidebarListItem[data-user_id="+e.user_id+"]").remove(),$("#friendsList .counter").html($("#friendsList .sidebarListItem").length),$("#friendsList .sidebarListItem").length||$("#friendsList .list").html("ru"==user.lang?"Здесь никого нет":"Nobody's here")));Friends.resize(),bindLinks()},OnlineStatus:function(e){"online"==e.status?($("#friendsList .sidebarListItem[data-user_id="+e.id+"]").attr("data-online","true"),$("#friendsList .sidebarListItem[data-user_id="+e.id+"] .sidebarListItemOptions").prepend('<div class="online">online</div>'),$("#friendsList .sidebarListItem[data-user_id="+e.id+"]").prependTo("#friendsList .list")):"offline"==e.status&&($("#friendsList .sidebarListItem[data-user_id="+e.id+"]").removeAttr("data-online"),$("#friendsList .sidebarListItem[data-user_id="+e.id+"] .sidebarListItemOptions .online").remove(),$("#friendsList .sidebarListItem[data-online=true]:last").length>0?$("#friendsList .sidebarListItem[data-user_id="+e.id+"]").insertAfter("#friendsList .sidebarListItem[data-online=true]:last"):$("#friendsList .sidebarListItem[data-user_id="+e.id+"]").prependTo("#friendsList .list"))},GamesOnline:function(e){$.each(e,function(e,s){1*$("#online-"+e).html()!=s&&$("#online-"+e).html(s)})},RoomsOnline:function(e){$.each(e,function(e,s){1*$("#online-"+e).html()!=s&&$("#online-"+e).html(s)})},Pms:function(e){if("newdialogue"==e.action){var s=$("#pmsList .sidebarListItem[data-id="+e.user_id+"]");s.length>0&&(s.find(".unread").length>0&&(e.newmsgs=e.newmsgs+1*s.find(".unread").html(),$("#pmsUnread").text(1*$("#pmsUnread").text()-1*s.find(".unread").html()),1*$("#pmsUnread").text()<1&&$("#pmsUnread").text("0").removeClass("show")),e.user_id==Pms.companionID&&$("#dialogueContent").is(":visible")&&(e.newmsgs=0),s.remove());var t='<div class="sidebarListItem" data-id="'+e.user_id+'" onclick="Pms.openDialogue(\''+e.user_id+'\'); return false;"><div class="avatar"><img src="/avatars/'+e.avatar+'" alt="'+e.username+'"><div class="usergroup '+e.group+'">'+e.group+'</div><div class="userlevel level'+e.level+'">'+e.level+'</div></div><div class="username"><span class="user">'+e.username+'</span></div><div class="text">'+e.msg+'</div><div class="time">'+e.date+'</div><div class="sidebarListItemOptions"><div class="option" onclick="Pms.delete(\''+e.user_id+"'); return false;\">✕</div></div></div>";$("#pmsList .sidebarListItem").length||$("#pmsList .list").html(""),$("#pmsList .list").prepend(t),$("#pmsList .counter").html($("#pmsList .sidebarListItem").length),e.newmsgs>0&&($("#pmsList .sidebarListItem[data-id="+e.user_id+"]").addClass("new"),$("#pmsUnread").text(1*$("#pmsUnread").text()+1*e.newmsgs),$("#pmsUnread").hasClass("show")||$("#pmsUnread").addClass("show"),e.newmsgs>0&&$("#pmsList .sidebarListItem[data-id="+e.user_id+"]").append('<div class="unread">'+e.newmsgs+"</div>")),1==e.mine&&$("#pmsList .sidebarListItem[data-id="+e.user_id+"]").addClass("mine"),1!=e.history&&1!=e.mine&&e.newmsgs>0&&!$("#messagesContent").is(":visible")&&Pms.newmessage.play(),Pms.resize(),bindLinks()}if("newmessage"==e.action){if(e.dialogue_id!=Pms.companionID||!$("#dialogueContent").is(":visible"))return!1;if($("#dialogueBody .msg[data-id="+e.id+"]").length>0)return!1;if($("#dialogueBody").append('<div class="msg" data-id="'+e.id+'"><div class="username"><span class="user">'+e.username+'</span></div><div class="time">'+e.date+'</div><div class="text">'+e.msg+"</div></div>"),e.user_id>0){new Date;$("#dialogueBody .msg[data-id="+e.id+"]").prepend('<div class="avatar"><img src="/avatars/'+e.avatar+'" alt="'+e.username+'" /></div>'),$("#dialogueBody .msg[data-id="+e.id+"]").addClass("ava").addClass("arrow")}if(1==e.usergroup&&$("#dialogueBody .msg[data-id="+e.id+"] .avatar").append('<div class="usergroup vip">VIP</div>'),2==e.usergroup&&($("#dialogueBody .msg[data-id="+e.id+"]").addClass("bot"),$("#dialogueBody .msg[data-id="+e.id+"] .username").html('<span class="bot">BOT</span> '+$(".msg[data-id="+e.id+"] .username").html())),3==e.usergroup&&$("#dialogueBody .msg[data-id="+e.id+"] .avatar").append('<div class="usergroup mod">MOD</div>'),4==e.usergroup&&$("#dialogueBody .msg[data-id="+e.id+"] .avatar").append('<div class="usergroup help">HELP</div>'),5==e.usergroup&&$("#dialogueBody .msg[data-id="+e.id+"] .avatar").append('<div class="usergroup legend">LEGEND</div>'),7==e.usergroup&&$("#dialogueBody .msg[data-id="+e.id+"] .avatar").append('<div class="usergroup admin">ADMIN</div>'),$("#dialogueBody .msg[data-id="+e.id+"] .avatar").append('<div class="userlevel level'+e.level+'">'+e.level+"</div>"),e.user_id==user.id?($("#dialogueBody .msg[data-id="+e.id+"]").addClass("me"),$("#dialogueBody .msg[data-id="+e.id+"] .username span").addClass("binduser").attr("data-username",e.username)):2!=e.usergroup&&$("#dialogueBody .msg[data-id="+e.id+"] .username span").addClass("binduser").attr("data-username",e.username),$("#dialogueBody .msg[data-id="+e.id+"]").prev().find(".username span.user").html()==$(".msg[data-id="+e.id+"] .username span.user").html()&&$("#dialogueBody .msg[data-id="+e.id+"]").addClass("glued"),1!=e.history){var i=$("#dialogueBody .msg").size();if(i>50)for(var a=0;a<i-50;a++)$("#dialogueBody .msg:first-child").remove(),$("#dialogueBody .msg:first-child").hasClass("glued")&&$("#dialogueBody .msg:first-child").removeClass("glued")}if(1==e.history&&"false"==e.read&&0==e.mine&&$(".msg[data-id="+e.id+"]").addClass("new"),bindLinks(),$("#dialogueBody .mCSB_dragger").hasClass("mCSB_dragger_onDrag")){var r=$("#dialogueBody .mCSB_dragger").height();parseInt($("#dialogueBody .mCSB_dragger").css("max-height"),10)-parseInt($("#dialogueBody .mCSB_dragger").css("top"),10)>1.5*r&&1!=e.history&&$("#dialogueNewMessagesBtn").fadeIn(0)}else 1!=e.history&&e.user_id!=user.id?Pms.dialogueScroll("bottom",150,100):1!=e.history&&e.user_id==user.id?Pms.dialogueScroll("bottom",150,100,1):Pms.dialogueScroll("bottom",0,0,e.history);Pms.confirmRead(e.id)}}},Chat={busy:!1,sendbusy:!1,sound:!0,room:!1,newmessage:new Audio("/assets/sounds/newmessage.mp3"),send:function(){if(1==Chat.sendbusy)return!1;Chat.sendbusy=!0,$.ajax({url:"/ajx/",type:"post",dataType:"html",data:"action=chatSend&socketID="+socket.socketID+"&room="+Chat.room+"&msg="+encodeURIComponent($.trim($("#chatTextarea").html()))+"&hash="+user.hash,success:function(e){Chat.sendbusy=!1,$("#chatTextarea").empty(),Chat.resize()},error:function(){Chat.sendbusy=!1,$.notification.error({title:"Error",message:"No connection to the server, please try again"})}})},changeRoom:function(e){Chat.busy=!0,$("#chatBody").empty(),$("#chatLog").addClass("busy"),$("#chatNewMessagesBtn").fadeOut(0),Chat.fix(),socket.id.send('{"action": "changeRoom", "params":{"room":"'+e+'"}}')},print:function(e){if($("#ignoreList .sidebarListItem[data-username="+e.username+"]").length>0||$("#chatLog").hasClass("busy"))return!1;if(1==Chat.busy)return!1;if($(".msg[data-id="+e.id+"]").length>0)return!1;if(void 0!=e.room&&e.room!=Chat.room)return!1;if($("#chatBody").append('<div class="msg" data-id="'+e.id+'"><div class="username"><span class="user">'+e.username+'</span></div><div class="time">'+e.time+'</div><div class="text">'+e.msg+'</div><div class="reply"><span class="icon quote" onclick="Chat.easyMessage(\''+e.username+"'); return false;\"></span></div></div>"),e.user_id>0){new Date;$(".msg[data-id="+e.id+"]").prepend('<div class="avatar"><img src="/avatars/'+e.avatar+'" alt="'+e.username+'" /></div>'),$(".msg[data-id="+e.id+"]").addClass("ava").addClass("arrow")}var s=e.msg,t="<b rel='user'>"+user.name+"</b>";if(-1!=s.indexOf(t)&&2!=e.usergroup&&($(".msg[data-id="+e.id+"]").addClass("addressed"),$(".msg[data-id="+e.id+"]").find("b").addClass("me")),"chatContent"!=$("#sidebar .tab.active").attr("data-id")&&1!=e.history&&("50"!=$("#chatUnread").html()&&$("#chatUnread").addClass("show").html(1*$("#chatUnread").html()+1),$(".msg[data-id="+e.id+"]").addClass("new")),1==e.usergroup&&$(".msg[data-id="+e.id+"] .avatar").append('<div class="usergroup vip">VIP</div>'),2==e.usergroup&&($(".msg[data-id="+e.id+"]").addClass("bot"),$(".msg[data-id="+e.id+"] .username").html('<span class="bot">BOT</span> '+$(".msg[data-id="+e.id+"] .username").html())),3==e.usergroup&&$(".msg[data-id="+e.id+"] .avatar").append('<div class="usergroup mod">MOD</div>'),4==e.usergroup&&$(".msg[data-id="+e.id+"] .avatar").append('<div class="usergroup help">HELP</div>'),5==e.usergroup&&$(".msg[data-id="+e.id+"] .avatar").append('<div class="usergroup legend">LEGEND</div>'),7==e.usergroup&&$(".msg[data-id="+e.id+"] .avatar").append('<div class="usergroup admin">ADMIN</div>'),2!=e.usergroup&&$(".msg[data-id="+e.id+"] .avatar").append('<div class="userlevel level'+e.level+'">'+e.level+"</div>"),e.user_id==user.id?($(".msg[data-id="+e.id+"]").addClass("me"),$(".msg[data-id="+e.id+"] .username span").addClass("binduser").attr("data-username",e.username)):2!=e.usergroup&&$(".msg[data-id="+e.id+"] .username span").addClass("binduser").attr("data-username",e.username),$(".msg[data-id="+e.id+"]").prev().find(".username span.user").html()==$(".msg[data-id="+e.id+"] .username span.user").html()&&$(".msg[data-id="+e.id+"]").addClass("glued"),1!=e.history){var i=$("#chatBody .msg").size();if(i>50)for(var a=0;a<i-50;a++)$("#chatBody .msg:first-child").remove(),$("#chatBody .msg:first-child").hasClass("glued")&&$("#chatBody .msg:first-child").removeClass("glued")}if(1!=e.history&&e.user_id==user.id&&($("#currentMessages").html(1*$("#currentMessages").html()+1),$("#overallMessages").html(1*$("#overallMessages").html()+1)),bindLinks(),$("#chatLog .mCSB_dragger").hasClass("mCSB_dragger_onDrag")){var r=$("#chatLog .mCSB_dragger").height();parseInt($("#chatLog .mCSB_dragger").css("max-height"),10)-parseInt($("#chatLog .mCSB_dragger").css("top"),10)>1.5*r&&1!=e.history&&$("#chatNewMessagesBtn").fadeIn(0)}else 1!=e.history&&e.user_id!=user.id?Chat.scroll("bottom",150,100):1!=e.history&&e.user_id==user.id?Chat.scroll("bottom",150,100,1):Chat.scroll("bottom",0,0,e.history)},resize:function(){var e=window.innerHeight-$("#chatContent .chatForm").height()-75;$("#chatLog").css("height",e+"px")},fix:function(){$("#chatLog").mCustomScrollbar("destroy"),$("#chatLog").mCustomScrollbar({scrollbarPosition:"outside",theme:"sidebar",scrollInertia:1e3,callbacks:{onTotalScroll:function(){$("#chatNewMessagesBtn").fadeOut(200)}}})},markRead:function(){setTimeout(function(){$("#chatLog .msg.new").removeClass("new")},2e3)},scroll:function(e,s,t,i){setTimeout(function(){var a=$("#chatLog .mCSB_dragger").height();if(parseInt($("#chatLog .mCSB_dragger").css("max-height"),10)-parseInt($("#chatLog .mCSB_dragger").css("top"),10)>1.5*a&&1!=i)return $("#chatNewMessagesBtn").fadeIn(0),!1;$("#chatLog").mCustomScrollbar("scrollTo",e,{scrollInertia:s,timeout:t})},20)},easyMessage:function(e){Chat.open(),$("#chatContent").is(":visible")||Sidebar.open("chatContent");var s="user:"+e,t=$("#chatTextarea").html();if(-1!=t.indexOf(s))return placeFocus("chatTextarea"),!1;-1!=t.indexOf("/pm ")&&(t=""),-1!=t.indexOf("/tip ")&&(t=""),$("#chatTextarea").html("user:"+e+",&nbsp;"+t),placeFocus("chatTextarea"),Chat.resize(),$(".tooltipster-base").remove()},easyPM:function(e){$("#pm").popupShow({data:e}),$(".tooltipster-base").remove()},easyTip:function(e){$("#tip").popupShow({data:e}),$(".tooltipster-base").remove()},easyBan:function(e){$("#ban").popupShow({data:e}),$(".tooltipster-base").remove()},easyProfile:function(e){$("#profile").popupShow({data:e})},open:function(){if("chatContent"==$("#sidebar .sidebarNav .tab.active").attr("data-id"))return!1;$("#sidebar .tab[data-id=chatContent]").click()},friends:function(e,s){$.ajax({url:"/ajx/",type:"post",dataType:"json",data:"action=friends"+s+"&username="+e+"&socketID="+socket.socketID+"&hash="+user.hash,success:function(e){0==e.result?$.notification.error({title:"Error",message:e.msg}):1==e.result&&$.notification.notice({title:"Success",message:e.msg})},error:function(){$.notification.error({title:"Error",message:"No connection to the server, please try again"})}})}},Friends={newrequest:new Audio("/assets/sounds/friendsrequest.mp3"),fix:function(){$("#friendsContent .sidebarListWrapper").mCustomScrollbar("destroy"),$("#friendsContent .sidebarListWrapper").mCustomScrollbar({scrollbarPosition:"outside",theme:"sidebar",scrollInertia:1e3})},resize:function(){var e=window.innerHeight-74;$("#friendsContent .sidebarListWrapper").css("height",e+"px")}},Pms={newmessage:new Audio("/assets/sounds/friendsrequest.mp3"),companionID:!1,companionUsername:!1,sendbusy:!1,openDialogue:function(e){if(!$("#pmsList .sidebarListItem[data-id="+e+"]").length)return!1;$("#dialogueBody").html(""),Pms.companionID=!1,Pms.companionUsername=!1,$.ajax({url:"/ajx/",type:"POST",dataType:"html",async:!0,data:{action:"openDialogue",id:e,hash:user.hash},success:function(s){if(1==(s=JSON.parse(s)).result){$("#dialogueBody").html("");var t=$("#pmsList .sidebarListItem[data-id="+e+"]");t.hasClass("new")&&(t.removeClass("new"),t.find(".unread").length>0&&($("#pmsUnread").text(1*$("#pmsUnread").text()-1*t.find(".unread").html()),1*$("#pmsUnread").text()<1&&$("#pmsUnread").text("0").removeClass("show"),t.find(".unread").remove())),Sidebar.open("dialogueContent"),Pms.companionID=s.user_id,Pms.companionUsername=s.username,$("#dialogueContent .sidebarTitle").html('<b class="binduser" data-username="'+s.username+'">'+s.username+"</b>"),actions[s.action](s.params),Pms.markRead(e)}},error:function(){$.notification.error({title:"Error",message:"No connection to the server, please try again"})}})},deleteMessage:function(e){$.ajax({url:"/ajx/",type:"post",dataType:"json",data:"action=deletePM&id="+e+"&socketID="+socket.socketID+"&hash="+user.hash,success:function(e){0==e.result?$.notification.error({title:"Error",message:e.msg}):1==e.result&&$.notification.notice({title:"Success",message:e.msg})},error:function(){$.notification.error({title:"Error",message:"No connection to the server, please try again"})}})},fix:function(){$("#pmsList").mCustomScrollbar("destroy"),$("#pmsList").mCustomScrollbar({scrollbarPosition:"outside",theme:"sidebar",scrollInertia:1e3})},resize:function(){var e=window.innerHeight-74;$("#pmsList").css("height",e+"px")},dialogueFix:function(){$("#dialogueLog").mCustomScrollbar("destroy"),$("#dialogueLog").mCustomScrollbar({scrollbarPosition:"outside",theme:"sidebar",scrollInertia:1e3,callbacks:{onTotalScroll:function(){$("#dialogueNewMessagesBtn").fadeOut(200)}}})},dialogueResize:function(){var e=window.innerHeight-$("#dialogueContent .chatForm").height()-75;$("#dialogueLog").css("height",e+"px")},dialogueScroll:function(e,s,t,i){setTimeout(function(){var a=$("#dialogueLog .mCSB_dragger").height();if(parseInt($("#dialogueLog .mCSB_dragger").css("max-height"),10)-parseInt($("#dialogueLog .mCSB_dragger").css("top"),10)>1.5*a&&1!=i)return $("#dialogueNewMessagesBtn").fadeIn(0),!1;$("#dialogueLog").mCustomScrollbar("scrollTo",e,{scrollInertia:s,timeout:t})},20)},send:function(){if(1==Pms.sendbusy)return!1;Pms.sendbusy=!0,$.ajax({url:"/ajx/",type:"post",dataType:"html",data:{action:"pmSubmit",username:Pms.companionUsername,message:$.trim($("#dialogueTextarea").html()),hash:user.hash},success:function(e){Pms.sendbusy=!1,1==(e=JSON.parse(e)).result?($("#dialogueTextarea").empty(),Pms.dialogueResize()):$.notification.error({title:"Error",message:e.msg})},error:function(){Pms.sendbusy=!1,$.notification.error({title:"Error",message:"No connection to the server, please try again"})}})},delete:function(e){var s=$("#pmsList .sidebarListItem[data-id="+e+"]"),t=$("#pmsList .sidebarListItem[data-id="+e+"]").find(".user").html();confirm("ru"==user.lang?"Вы уверены, что хотите удалить диалог с "+t+"?":"Are you sure to delete conversation with "+t+"?")&&s.length>0&&(s.remove(),s.find(".unread").length>0&&($("#pmsUnread").text(1*$("#pmsUnread").text()-1*s.find(".unread").html()),1*$("#pmsUnread").text()<1&&$("#pmsUnread").text("0").removeClass("show")),$("#pmsList .counter").html($("#pmsList .sidebarListItem").length),$("#pmsList .sidebarListItem").length||($("#pmsList").removeClass("show"),$("#pmsList .list").html('<div class="sidebarListItemNothing">'+("ru"==user.lang?"Диалоги не найдены":"No conversations found")+"</div>")),$.ajax({url:"/ajx/",type:"post",dataType:"html",data:{action:"deleteDialogue",id:e,hash:user.hash}}))},markRead:function(e){setTimeout(function(){e==Pms.companionID&&$("#dialogueContent").is(":visible")&&$("#dialogueLog .msg.new").removeClass("new")},2e3)},confirmRead:function(e){$.ajax({url:"/ajx/",type:"post",dataType:"html",data:{action:"confirmReadPM",id:e,hash:user.hash}})}};